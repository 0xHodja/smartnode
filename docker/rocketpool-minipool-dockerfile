###
# Builder
###


# Start from golang image
FROM golang:latest AS builder

# Copy source files
ADD ./rocketpool-minipool /go/src/github.com/rocket-pool/smartnode/rocketpool-minipool
ADD ./shared /go/src/github.com/rocket-pool/smartnode/shared
ADD ./vendor /go/src/github.com/rocket-pool/smartnode/vendor

# Install go dependencies
WORKDIR /go/src/github.com/rocket-pool/smartnode
RUN go get -d github.com/ethereum/go-ethereum
RUN go get -d github.com/ethereum/go-ethereum/internal/ethapi
RUN go get -d github.com/ethereum/go-ethereum/accounts/usbwallet

# Compile & install
RUN go install github.com/rocket-pool/smartnode/rocketpool-minipool


###
# Process
###


# Start from ubuntu image
FROM ubuntu:18.04

# Copy binary
COPY --from=builder /go/bin/rocketpool-minipool /go/bin/rocketpool-minipool

# Container entry point
ENTRYPOINT ["/go/bin/rocketpool-minipool"]
