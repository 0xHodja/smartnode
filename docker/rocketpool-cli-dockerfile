###
# Builder
###


# Start from golang (debian) image
FROM golang AS builder

# Copy source files
ADD ./rocketpool-cli /go/src/github.com/rocket-pool/smartnode/rocketpool-cli
ADD ./shared /go/src/github.com/rocket-pool/smartnode/shared

# Install go dependencies
WORKDIR /go/src/github.com/rocket-pool/smartnode
RUN go get -d ./...

# Compile & install
RUN go install github.com/rocket-pool/smartnode/rocketpool-cli


###
# Process
###


# Start from debian image
FROM debian

# Copy binary
COPY --from=builder /go/bin/rocketpool-cli /go/bin/rocketpool-cli

# Container entry point
ENTRYPOINT ["/go/bin/rocketpool-cli"]
